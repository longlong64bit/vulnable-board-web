# CVE-2025-55182 (React2Shell) 테스트 안내

## 취약점 요약

- **CVE**: CVE-2025-55182 (React2Shell)
- **유형**: React Server Components(RSC) 원격 코드 실행 (RCE), 인증 불필요
- **CVSS**: 10.0
- **영향**: RSC 스트림 역직렬화 시 `Function` 생성자 등으로 서버에서 임의 코드 실행

## 취약 버전

| 패키지 | 취약 버전 | 패치 버전 |
|--------|-----------|-----------|
| React (react-server-dom-*) | 19.0.0, 19.1.0, 19.1.1, **19.2.0** | 19.0.1, 19.1.2, 19.2.1 이상 |
| @vitejs/plugin-rsc | ≤ 0.5.2 | 0.5.3 이상 |
| Next.js (App Router) | 해당 버전 대응 구간 | 15.0.5, 15.1.9 등 패치 버전 |

## 현재 프로젝트 적용 상태

- **frontend**: `react` / `react-dom` **19.2.0** 사용 (취약 버전 번호 적용).
- 이 프로젝트는 **클라이언트 전용 SPA**(Vite + React, RSC 미사용)이므로 **RSC 역직렬화 경로가 없어 실제 RCE는 발생하지 않습니다.**
- 취약점이 **발생(트리거)** 하려면 **RSC를 사용하는 서버/엔드포인트**가 있어야 합니다.

## RSC 기반으로 취약점 테스트하는 방법

실제 RCE를 재현하려면 RSC를 쓰는 환경이 필요합니다.

### 1) Next.js (App Router) + React 19.2.0

```bash
npx create-next-app@latest my-rsc-test --typescript --app --no-src-dir
cd my-rsc-test
npm install react@19.2.0 react-dom@19.2.0
# next는 취약 구간 버전으로 고정 (예: 15.0.0 ~ 15.0.4 등, 공개 권고 확인)
```

개발 서버 실행 후 RSC 페이로드를 받는 엔드포인트에 악성 요청을 보내 PoC 테스트.

### 2) 본 프로젝트의 RSC 테스트 앱 (frontend-rsc) + 인증 없는 HTTP 테스트

`docker compose up -d` 후 RSC 서버가 **http://localhost:5174** 에 떠 있습니다.

**인증 없이** RSC 역직렬화를 트리거하는 전용 API가 있습니다.

| 항목 | 내용 |
|------|------|
| **URL** | `POST http://localhost:8888/api/rsc/render` (메인 앱 경유, 권장) 또는 `POST http://localhost:5174/api/rsc/render` (RSC 서버 직접) |
| **인증** | 없음 |
| **Body** | RSC(Flight) 페이로드 원시 바이트 |
| **Content-Type** | `text/x-component` (권장) |

**curl 예시**

```bash
# 1) 정상 RSC 스트림 저장
curl -s "http://localhost:5174/?rsc" -o payload.bin

# 2) 역직렬화 API 호출 (인증 없음) — 메인 앱(8888) 경유로 정상 API처럼 호출
curl -X POST "http://localhost:8888/api/rsc/render" \
  -H "Content-Type: text/x-component" \
  --data-binary @payload.bin
# RSC 서버(5174) 직접: curl -X POST "http://localhost:5174/api/rsc/render" ...
```

PoC 페이로드가 있으면 위와 같이 `--data-binary @poc.bin` 으로 전송해 RCE 테스트 가능.

### 3) Vite + @vitejs/plugin-rsc 0.5.2 (별도 생성 시)

```bash
npm create vite@latest rsc-vuln-test -- --template rsc
cd rsc-vuln-test
npm install
npm install react@19.2.0 react-dom@19.2.0 @vitejs/plugin-rsc@0.5.2
# 기타 의존성은 호환되는 범위에서 설치
npm run dev
```

RSC 스트림을 처리하는 URL(예: `*.rsc` 또는 서버 액션 엔드포인트)에 공개된 PoC 요청을 보내 테스트.

### 4) PoC / 참고 자료

- **본 프로젝트 PoC**: 프로젝트 루트의 **`poc/`** 폴더에 Python·Node 스크립트가 있습니다.  
  `python poc/cve-2025-55182-poc.py` 또는 `node poc/cve-2025-55182-poc.mjs` 로 `POST /api/rsc/render` 에 Flight 페이로드를 전송해 역직렬화를 트리거할 수 있습니다. 자세한 사용법은 `poc/README.md` 참고.
- [React 공식 보안 공지](https://react.dev/blog/2025/12/03/critical-security-vulnerability-in-react-server-components)
- [JFrog 등 보안 분석](https://jfrog.com/blog/2025-55182-and-2025-66478-react2shell-all-you-need-to-know/)  
  (실제 페이로드 예시는 보안 연구/공개 PoC 문서 참고)

## 정리

- **현재 이 리포지토리**: React 19.2.0 사용으로 **취약 버전**을 쓰고 있으나, RSC 미사용으로 **실제 React2Shell RCE는 발생하지 않는 구성**입니다.
- **취약점이 “발생”하는 환경에서 테스트**하려면 **본 프로젝트의 frontend-rsc**를 사용하면 됩니다. 메인 앱이 **`POST /api/rsc/render`** 로 RSC 스트림 API를 제공하므로(인증 없음), 8888 포트만으로 정상 기능처럼 호출해 테스트할 수 있습니다. 또는 **Next.js App Router** / **Vite + @vitejs/plugin-rsc ≤0.5.2** 등 RSC 서버를 띄운 뒤 해당 엔드포인트에 PoC를 보내면 됩니다.

## RCE까지 확인하려면

이 프로젝트의 **frontend-rsc**(Vite 6 + plugin-rsc 0.5.2)에서는 **역직렬화**는 되지만, 공개 PoC의 페이로드 형식이 이 파서와 맞지 않아 **RCE가 트리거되지 않습니다.** RCE까지 확인하는 방법은 다음과 같습니다.

### 방법 1: 이 프로젝트의 RSC 재생 API 사용 (권장)

본 프로젝트는 **RSC 재생 API** (`POST /api/rsc/replay`)를 제공합니다. 스트림 내 실행 가능 청크(`_prefix`)를 서버에서 실행하므로, **별도 Next.js 없이** 이 환경에서 RCE를 시연할 수 있습니다.

```bash
py cve-2025-55182-poc.py --rce-inject --replay
```

- 500 응답 본문의 `error`에 `ls` 등 명령 출력이 포함됩니다. (PoC가 "[+] RCE 출력"으로 표시)
- 메인 앱(8888)이 `/api/rsc/replay`를 frontend-rsc로 프록시하므로, 위 한 줄로 동작합니다.

### 방법 2: Next.js에서 RCE 재현

1. Next.js App Router + React 19.2.0 취약 버전으로 앱을 만들고 개발 서버를 띄웁니다.
2. 같은 PoC를 **Next.js 루트 URL**로 `--multipart` 또는 공개된 Next.js용 페이로드로 전송합니다. (Next.js는 Server Actions 경로에서 `decodeReply`를 사용하므로 multipart 형식이 동작합니다.)
3. 500 응답 본문에 명령 실행 결과가 포함되거나, 서버 로그에 출력됩니다.

자세한 Next.js 설정은 위 "1) Next.js (App Router)" 참고.

### 방법 3: 이 환경(frontend-rsc)에서 /render 로 스트림 수정 후 시도

1. **스트림 형식 확인**: `py cve-2025-55182-poc.py --analyze` 로 실제 RSC 스트림의 바이트/행 구조를 확인합니다.
2. **스트림 저장**: `py cve-2025-55182-poc.py --save-stream payload.bin` 으로 저장한 뒤, hex 에디터나 스크립트로 청크 정의(`_response`, `_formData` 등) 위치를 찾습니다.
3. **악성 청크 주입**: 파서가 참조하는 청크 ID에 `_formData.get: constructor:constructor` 가 들어 있는 객체를 악성 코드로 바꾼 뒤, 수정된 바이너리를 `POST /api/rsc/render` 에 전송합니다. (스트림이 길이 접두어/바이너리 형식이면 길이·체크섬 등을 맞춰야 할 수 있습니다.)
4. **전송**: `curl -X POST "http://localhost:8888/api/rsc/render" -H "Content-Type: text/x-component" --data-binary @modified.bin` — RCE가 성공하면 500 응답 본문에 명령 출력이 포함됩니다.

**요약**: 이 프로젝트에서 RCE를 보려면 **방법 1(재생 API + --replay)** 를 사용하면 됩니다. Next.js가 따로 있으면 **방법 2**로도 재현 가능하고, **방법 3**은 스트림 분석·수정이 필요합니다.
